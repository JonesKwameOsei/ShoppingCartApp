@using System.Globalization
@model IEnumerable<ShoppingCartApp.Models.Item>

@{
    ViewData["Title"] = "Shopping Cart";
    var cartTotal = Model?.Sum(item => item.Price * item.Quantity) ?? 0;
    var itemCount = Model?.Sum(item => item.Quantity) ?? 0;
}

<div class="container mt-4">
    @*Success message section*@
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="bi bi-check-circle-fill me-2"></i>
            <strong>Success!</strong> @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="display-5">
                <i class="bi bi-cart-fill text-primary"></i> Shopping Cart
            </h1>
            <p class="text-muted">Manage your cart items</p>
        </div>
        <div class="text-end">
            <a asp-action="Create" class="btn btn-primary btn-lg">
                <i class="bi bi-plus-circle"></i> Add New Item
            </a>
        </div>
    </div>

    @if (Model?.Any() == true)
    {
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card text-center shadow-sm">
                    <div class="card-body">
                        <i class="bi bi-bag-check text-primary" style="font-size: 2rem;"></i>
                        <h5 class="card-title mt-2">Total Items</h5>
                        <p class="card-text display-6">@itemCount</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-center shadow-sm">
                    <div class="card-body">
                        <i class="bi bi-box-seam text-success" style="font-size: 2rem;"></i>
                        <h5 class="card-title mt-2">Products</h5>
                        <p class="card-text display-6">@Model.Count()</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-center shadow-sm">
                    <div class="card-body">
                        <i class="bi bi-currency-pound text-warning" style="font-size: 2rem;"></i>
                        <h5 class="card-title mt-2">Cart Total</h5>
                        <p class="card-text display-6">@cartTotal.ToString("C", new CultureInfo("en-GB"))</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h5 class="mb-0"><i class="bi bi-list-ul"></i> Cart Items</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th style="width: 100px;">Image</th>
                                <th>Product</th>
                                <th>Item Name</th>
                                <th style="width: 100px;">Quantity</th>
                                <th style="width: 120px;">Unit Price</th>
                                <th style="width: 120px;">Total</th>
                                <th style="width: 180px;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td>
                                        @if (!string.IsNullOrEmpty(item.Product?.ProductImage))
                                        {
                                            <img src="@item.Product.ProductImage"
                                                 alt="@item.Product.ProductName"
                                                 class="img-thumbnail"
                                                 style="max-width: 80px; max-height: 80px; object-fit: cover;" />
                                        }
                                        else
                                        {
                                            <div class="text-center p-2 bg-light rounded">
                                                <i class="bi bi-image text-muted" style="font-size: 2rem;"></i>
                                            </div>
                                        }
                                    </td>
                                    <td class="align-middle">
                                        <strong>@item.Product?.ProductName</strong>
                                    </td>
                                    <td class="align-middle">@item.Name</td>
                                    <td class="align-middle">
                                        <span class="badge bg-info rounded-pill">@item.Quantity</span>
                                    </td>
                                    <td class="align-middle">
                                        @item.Price.ToString(format: "C", provider: new CultureInfo(name: "en-GB"))
                                    </td>
                                    <td class="align-middle">
                                        <strong>@((item.Price * item.Quantity).ToString(format: "C", provider: new CultureInfo(name: "en-GB")))</strong>
                                    </td>
                                    <td class="align-middle">
                                        <div class="btn-group" role="group">
                                            <a asp-action="Details"
                                               asp-route-id="@item.Id"
                                               class="btn btn-sm btn-info text-white"
                                               title="View Details">
                                                <i class="bi bi-eye"></i>
                                            </a>
                                            <a asp-action="Edit"
                                               asp-route-id="@item.Id"
                                               class="btn btn-sm btn-warning"
                                               title="Edit">
                                                <i class="bi bi-pencil"></i>
                                            </a>
                                            <a asp-action="Delete"
                                               asp-route-id="@item.Id"
                                               class="btn btn-sm btn-danger"
                                               title="Delete">
                                                <i class="bi bi-trash"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                        <tfoot class="table-light">
                            <tr>
                                <td colspan="5" class="text-end"><strong>Grand Total:</strong></td>
                                <td colspan="2">
                                    <strong class="text-primary fs-5">
                                        @cartTotal.ToString("C", new CultureInfo("en-GB"))
                                    </strong>
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="text-center py-5">
            <i class="bi bi-cart-x text-muted" style="font-size: 5rem;"></i>
            <h3 class="mt-3 text-muted">Your cart is empty</h3>
            <p class="text-muted">Start adding items to your cart</p>
            <a asp-action="Create" class="btn btn-primary btn-lg mt-3">
                <i class="bi bi-plus-circle"></i> Add First Item
            </a>
        </div>
    }
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Add fade-in animation to table rows
            const rows = document.querySelectorAll('tbody tr');
            rows.forEach((row, index) => {
                row.style.animation = `fadeIn 0.5s ease-in-out ${index * 0.1}s both`;
            });

            // Add hover effect tooltips
            const actionButtons = document.querySelectorAll('[title]');
            actionButtons.forEach(button => {
                button.setAttribute('data-bs-toggle', 'tooltip');
            });

            // Initialize Bootstrap tooltips if available
            if (typeof bootstrap !== 'undefined') {
                const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
                tooltipTriggerList.map(function (tooltipTriggerEl) {
                    return new bootstrap.Tooltip(tooltipTriggerEl);
                });
            }
        });
    </script>

    <style>
        @@keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
}