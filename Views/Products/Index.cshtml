@using System.Globalization
@model IEnumerable<ShoppingCartApp.Models.Product>

@{
    ViewData["Title"] = "Products";
    var productCount = Model?.Count() ?? 0;
    var totalValue = Model?.Sum(p => p.Price) ?? 0;
}

<div class="container mt-4">
    @* Success message section *@
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="bi bi-check-circle-fill me-2"></i>
            <strong>Success!</strong> @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="display-5">
                <i class="bi bi-box-seam-fill text-primary"></i> Product Catalog
            </h1>
            <p class="text-muted">Manage your product inventory</p>
        </div>
        <div class="text-end">
            <a asp-action="Create" class="btn btn-primary btn-lg">
                <i class="bi bi-plus-circle"></i> Create New Product
            </a>
        </div>
    </div>

    @if (Model?.Any() == true)
    {
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card text-center shadow-sm">
                    <div class="card-body">
                        <i class="bi bi-box-seam text-primary" style="font-size: 2rem;"></i>
                        <h5 class="card-title mt-2">Total Products</h5>
                        <p class="card-text display-6">@productCount</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-center shadow-sm">
                    <div class="card-body">
                        <i class="bi bi-currency-pound text-success" style="font-size: 2rem;"></i>
                        <h5 class="card-title mt-2">Total Value</h5>
                        <p class="card-text display-6">@totalValue.ToString("C", new CultureInfo("en-GB"))</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-center shadow-sm">
                    <div class="card-body">
                        <i class="bi bi-graph-up text-warning" style="font-size: 2rem;"></i>
                        <h5 class="card-title mt-2">Avg Price</h5>
                        <p class="card-text display-6">
                            @((productCount > 0 ? totalValue / productCount : 0).ToString("C", new CultureInfo("en-GB")))
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h5 class="mb-0"><i class="bi bi-list-ul"></i> Product List</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th style="width: 100px;">Image</th>
                                <th>Product Name</th>
                                <th style="width: 120px;">Price</th>
                                <th style="width: 180px;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var product in Model)
                            {
                                <tr>
                                    <td>
                                        @if (!string.IsNullOrEmpty(product.ProductImage))
                                        {
                                            <img src="@product.ProductImage"
                                                 alt="@product.ProductName"
                                                 class="img-thumbnail"
                                                 style="max-width: 80px; max-height: 80px; object-fit: cover;" />
                                        }
                                        else
                                        {
                                            <div class="text-center p-2 bg-light rounded">
                                                <i class="bi bi-image text-muted" style="font-size: 2rem;"></i>
                                            </div>
                                        }
                                    </td>
                                    <td class="align-middle">
                                        <strong>@product.ProductName</strong>
                                    </td>
                                    <td class="align-middle">
                                        <strong class="text-success">
                                            @product.Price.ToString("C", new CultureInfo("en-GB"))
                                        </strong>
                                    </td>
                                    <td class="align-middle">
                                        <div class="btn-group" role="group">
                                            <a asp-action="Details"
                                               asp-route-id="@product.Id"
                                               class="btn btn-sm btn-info text-white"
                                               title="View Details">
                                                <i class="bi bi-eye"></i>
                                            </a>
                                            <a asp-action="Edit"
                                               asp-route-id="@product.Id"
                                               class="btn btn-sm btn-warning"
                                               title="Edit">
                                                <i class="bi bi-pencil"></i>
                                            </a>
                                            <a asp-action="Delete"
                                               asp-route-id="@product.Id"
                                               class="btn btn-sm btn-danger"
                                               title="Delete">
                                                <i class="bi bi-trash"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="text-center py-5">
            <i class="bi bi-box-seam text-muted" style="font-size: 5rem;"></i>
            <h3 class="mt-3 text-muted">No products available</h3>
            <p class="text-muted">Start by adding your first product</p>
            <a asp-action="Create" class="btn btn-primary btn-lg mt-3">
                <i class="bi bi-plus-circle"></i> Add First Product
            </a>
        </div>
    }
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Add fade-in animation to table rows
            const rows = document.querySelectorAll('tbody tr');
            rows.forEach((row, index) => {
                row.style.animation = `fadeIn 0.5s ease-in-out ${index * 0.1}s both`;
            });

            // Add hover effect tooltips
            const actionButtons = document.querySelectorAll('[title]');
            actionButtons.forEach(button => {
                button.setAttribute('data-bs-toggle', 'tooltip');
            });

            // Initialize Bootstrap tooltips if available
            if (typeof bootstrap !== 'undefined') {
                const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
                tooltipTriggerList.map(function (tooltipTriggerEl) {
                    return new bootstrap.Tooltip(tooltipTriggerEl);
                });
            }
        });
    </script>

    <style>
        @@keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
}